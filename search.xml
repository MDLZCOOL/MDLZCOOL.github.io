<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Windows下Clash for Windows使用教程</title>
    <url>/post/5d67cfa0.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码有误，请重试" data-whm="解密的内容无法被验证，但仍可阅读">
  <script id="hbeData" type="hbeData" data-hmacdigest="b047d732cd370f96a5388f435aee88102a7e90e07ce60633ea9b54efb322245a">47022147e90c44422e41799f4f1da17a94326b94c12a7c9acaeda2b0aac5403195c5faaff732f2e4a4188faceb52392827b747cce9ac136c10d7fc9bdc35e0aae0d8627d479e784024454a9f7025234f144ff9334fa0daf9d38cc4f78abf1c8518632c9bac67fb83f934beb48d8c53019a72e774cb4b264b5ae39383d8812ef9356460bff6cffd59c1e82cb2284543dd4f3955be1f8a9d8b691f4a266ee9df9bc034bbd5db8e2e90270e843676ddb7bf7fba02dd3d4bdeacce04464a5353891aa73dace6c523421121f9a54bf3137483086ed5a0209617638782b6665bb57f4542275338c030a73d038abbf8d02d11e95578ae7bcd1293283f6953deb57fc0dee62be3eef7c9d788e1451896f80781e0edae6d75646fbf2df71f8b7f0d8c25efa6b88b10ece7196c2e8d767b8259882b30012dfcd45e9740d57c8e214e35ba038f823da89ff22dc761b9e4cef5079f24ec93efd792e86c82958c380ccf640d80859cb3dd31a8ad89da769360b783d06ec33effb093bbd695c6df7be7dc7b1ddbf77f5c81c0a1bac2642c17135a683b5504a8b8eaddce772148a5bed1ed691763595f3d58a90c420ead9fa3cc711485822358b127806eea5f6b1481def343f0b60623ecb2951a7f4c4a1f672356087aaefaf2003a24d613890682ae3a0b9a54bcc83bbf8bd6a89afb97c5239128a83b4c8ac9e80bca3f91666173da5a555822dcc0a578b2badeff426115352e678ec40b6e44d860970cd6f9f3773ba5f9ea5af249ae0462f846058726bdc4bcba02595650eb4cc6bf27a45bf0c49a9d2e515c73b2df7c89a160fadec595496e1e3e20250a7e1a9a85fd87130bf9287ecbc8c6a2b6ec259f694ca189df462adf9e23196f3b8bf210bf4470b86b58cf11c1e37152bc711970fab15f37fbfdde3c2c6f419e4477e57f7dbff55ea0f15c994ee7a0d01ae9f8d6bb307fbc29f074dbc1293c2821377adb2edcd39fb3ca9373121cd61869524525fe6f7cba37e005d979d2de92111e42e5068afcf49b6dd86ff5fa149f2edfa6ab3c70e5869cfddd3659ac623acd64d8b93af4c0ff0ff4f5d4d77d8b6bc6ee48faaae55f691af05318db536350aaed231ab18d65cc77a189dc8c597dbf1a12f284b09c83d220e36ea5ce828046a1ca052a06877bdc6bed7143f27afabff4898a641f58e0046e4f0af47e38e5c0281bcbef1d251f3234361f3b8a6b9f6bdc51535812c8f73649b78149364771671d4e2bf89de9b78d6926906b9f13ee6ed45c40af8d4bbf046fb80001b7bc5b6d9f857af2ab4dd71c07b5c9ee5a78f1a5084c01cfeb70d9407bc0343c33f874040354cbdad2deb0c587a8e10c39b89655138296657b3230099b3c0ebc023765a4f0f8f86ddf4ccf292f76bf4cf2d5d2a47b1657b7aa6bf0dd5c5676fc134d6a390ecb056ff89a240bab8f87094413a61a71af474b2b5b04de8334f0d51e9ae81d3a773351d9720ea2442b82e79bb76ca4431b51f91ca50bed1666467dd3086cdf79adfb455ddb672d7ca89cb31a4b31d7c46fbb96b761eae9e3315ce8a2d9dbc374eaebeef3f52caf854fbeb9a4c1f968514addb5c105c6f23aae2d9132afa33dd46963abe6031f4ec87304bd83d98aa227f460c2163c6c7219a7b5a66a6781f27242e483a2c73db63dd182fc7f827f2c6e2b87fb3b3906e722c26af216651f202174b2be14cf3afaed60286206bdc34659e786054658a62a6b1c73e79935c7e348482a9ab5882122775eeb98914f851bec2c5af8834408adf50e978f2dcdd225f6c688ebc7b320c0700513062b6758305ac8dd94a5d25004c70abf4877fb62799b18968fdba2b567dfdfdd1c41b32edba57ef3c2cc45ec6f9f8d712975d5be954f46c9f45c93edf13aa9d875bcf7eba36ed1d1a3d9a86308f414d93e9159073867059a36c4be0b4c5aedd5910ec585c741767844f5dafe1abf1f1f580750ce9a3172e50e35ff5d3c768b2becd0247a66f513da692a78b613f2ab6b3baaabd3c8309935662183d04557ef3d2a14575850f5e19ad8642b6154b620082fcccbeb13dceecdc1efc2b762b5f53155152aba3039e9eb838476dde41685fdc221518abb6a8647eb604d38be0cfe5e267e7c9757751e711539022d5be30d5768e5f6f7dba95e07d89addb8f74f40c223abd2b4484e55e773c1afb6c51ebe91ea42be6acf918f7cc04b735af9a2f835625c5c5f296cf23f93f3f363f42792dfe1db14b55d8ec40404c8335893e57fc5d6720fe200b03f9e899ef65efe214b95a19106c31f6a1feba9fb04430d8e128428e83348dad331c55261127eff30926bb406423e39ccbe2d6d41ce6e5d632ad57df2973a75c2a1ca56ea676b0431f84aea290228369c7c6f39dde4bb66840b233eccc56d87d3dca7c7fd5c399b1b6363cffc32442654d84a82c28c849869dbfb20df7a1a866ccbea3c990390d253c88f77d2588944b7ac15f44a70e21dcc5e720384f3ce1dc761cdbb9c68e2a9f6df27d1139d1c075813820c5411bfdd809d6b9c52d61b1201e02a13b721119a96de220c2be9441833e46c323a46134582e99a234783498516519b401892d9b119b43a8134080ff8b638bcd75fa96518094e6b385f3bae9ab3b80bb70ca0499979f0f7b3f1221cbfa2bce7baaf44d3dbbbc3056cd7c503822df2640ecc45f8afb4e39ce5f423abc8b88ab449d0beba96d83e819e12fc4a82c3e02c282d87e658cee5a93f9d59cee32e28d83f66697e6460b14376ea4632340d320da6f66116773feeb5febce4b1fb251f1b7f328f80b083cd593624ce959a16a1dfcaf5fbb2bdf3105a1c39b2cc6154a04b1c0759448e620c55dbe50e6e30eae5562d1c19c64f17aa8b76236a65a559a873165da92cc74142e13194bd1a3694652c81e8b552c32d04261bf5489543ee12cde1b8e86ad4b79d1cf247cb5a28cc2fa3e642f742343b91ac46e077e9857c0ee8df63a1ab33da1457132b0a69b9ef411b0b0624f4e2ea5c8336c136c5892cdf2c83b3d4502daf7fb15d5a21f9bc785df2479dfeed49f635ed9bbf965631dc090fb1fb85ab7c1a84b569bacf08108c0cde1f1289535492ac541b701999fb9e6456810160307a0cf2cbafc0527de56b558114cbf0cf1ca046fe34f77dbdbca64e533e3d3b95d4354c7671ae314e2152beb154cffac37dc13b6dadbee8f2587afc73d935af35a8613530cc0c5af330dfee98b72d1e8ccc1890adf82e0c10aa071bd2d33b276dac864a8796ff4f748decba888106718bede525ed0331aead5e07dfc75f433b090a0e72eadbfb51ea811438e1eb03a3c66c98217fff991ff5a2ba4c9b52315e389cc300ea1b051cea7d21032de87ae972b9f6fb012968e3314bdcc87c8a347cfc5d1d32b0b2036c2166e21c2d3fbfcf8b1a76d29b8ca00e51d87ec5789cc1393d191a07b78aec9eb80c644a307aa4e115a126e2d819357d47edee7ef59d56bbb720a120fcabe89124419c659061b9b4520fb373796218612c0c7f30a850d72f9a50cd5fd892eade55c4a2f38666530ebb6ff34a70594e08e096d24889e649fdbf183f0a61db5923a0dfb2d5a26f0ef56d0e3c01715f0e277508838e98ab65cbbaafa2870658a8ace01e82182ced5509d2b33eb233ca0d7fc85b1cbcff07808a827dfc660a6f18086190e6ea2ed29cb8fedfd61344b26a2579c026f21038276c6abd3be8ae7d3cb96245256adfe584b7f2e6aff50f520bdb95d85a0bc715c012cbc2f0b5daff784c4fb7c58d44e5fcab043cbdce81e8ff062402b15ba69ecd9469471b2226132830ae41e05045cf68de8c82d9fdfb09f0c93c5f913fca584980d1a2f1edbed65542a7de9a83cfffacac4dce011bc20078eaca7ddf6063a2a7f57cea1863a07954ad52abdb22a59888ffff06d6104bda435b53628006573f0e90a37750ee9eb36104c6a5b71df7e90d8cd18bcd287c41cb0d871ac5cd0b1975ce4f0534545b8f78e2c17b2509b4318e89504375e51ea066e8593e7fde070c89a1424210e24541ce5c04cbc55516f54850b13f6dd56c3b5abffd55099dba3a8a8285ec9930f944aa19270efc565098cedb7652ca27f5d0e468600dd4cfe1dc6663a5db22d3e6d32d9fb0e8fceb5ad8cb928128654949a225acb2f826b4a45ee7f6e249ac4b01e0bb7ab2061292165ac7931257056913c9557b38d1aa9b66260eaf7c0698e44382db098011d044ed800e023a1a2c91af0d905070b1b5462e08cbf3d62c130cb94760830c0542512624304e093609e63b1a8aebbbb1c1fc888630c53fe6cb9c39fbdcfe0168be751510997b96fa6071603b519912796626a89f79c10b0df5dac5acbad377844d8576d6c0e7bc7d2fefc1b5be5566b4a67e136a759b3ac5e057f76fe45ce338e5fbf1ce26b2d67b277c6d85d3a21962bde77a6e95ba38bbf3d8befcdeb69ef8a2fd886ff1d6046787956bdc5620224da5d449a3fab47639c4232f42603968be18b8477302bc3df3e3263b070dfe14b97aeca058f14037925f14a433f7938c6a5277191313183a1e35ef0fd60c6dec84516b03bbb3680534d87e03bf647a0be4ec0da0e6049b830e5489f8c822481c3e94e494f4e1d693b12420d9e7b1263e95699fc32e3a064c38af208e7bc41069ce9ec3bd14fa56cea6f04f1dfdce318d19f7f6ee14c26a6ba9b7e064f52c767982cd07ee48905bfd9abdc30abe134ee87d55b16b78821f47586d83846e4e7055979573dd7f080189a09f6b44eb5c61ab3260b5332389263668fae9e927090d921bdc5eb487a2e59cc0c524f897c830e32af92e45a8861be6038773a13dbeeef3763fbf74a90478362c04a724c8efcfb177d18c0557d4280d9b7f0b571ba573feb1584d4d18bf8425de0bfa5845bd8ee6c802bef8c71b85a4e0657ab871d23daf0445cd7c14ae629edd3d23c17b840706164013e671da9ed86d0704ce7e2547edb902e70bf462a074039bab98679e5cdf2998c01f8abbd7ef46a6070dcce803140b2a6c7b5fd22d87edea6d93b5f4dd8078494f794c655541acd7090220928b85fafcfdb625ab1968efd1ffdbc5f1cbfab51e60a951d571897f332b62ef1033c34fd4ff0cc064067e5c4649c3949daac1b3ef45bfe605c7b94b2560c4412d3f801e48464376abe6682db74bfaef9ab706ba0a56ee87ad4c3c01eb1fe44727b2e059a6ea1eb3e1f91be4192ca70dc10c81bfdb9449d4e0307d3c85c937412396da86aeb3fa05f52c1a2d232efe229b4b6f815aeb6cdb10b28ba4ec1056051246dc040bffa47ab73207a2175899a3871b94c939b63874526ada0796d4c413a1c53825db25926c6b27bcc9379f19ce002acb406e541de391c4aaab37e6ad6be3dcbbe95847816373e116b25e209e5a5e47e145cbfd5fea3fd60319625252fdc574a5f146242481005077c729f96db585ca6788eb78ba3f2eabfe58a62cb2373e44034b0b82246de393dd3c129a9f22122ef09849199eaaeb740fbb53eb835cb56e54c1ee0b190b09dff2e3e6e2ddc0303f5dfd2fd3120e901a60e18bf1315240a284562a0215fa32cc2ce3700cb33ebea8f8a46ba2c54b863b0b1671fc78e8be8419c08326681e439c1883fc52c70d030b88049a0c5130116d469d4d446ece71edc52f6d80d29f160308dd1f9d4177eef278265a61feb43fed52d9e70a5cb5e9f4c4df0327c52a2b42e20bc9756db3a23244dacd5f7de839ef80653cc1c08194879cba7d937e01c4d095ec753aa648bd87464f27b5b78af99b54b0bb8517a21fca4aedce9053ff2a9f3b68c67a68655ee8244cdcf99f5de61ef4071df968ac8d77e953c7af41664b1fe5ba5773d2b23a379da6ebc8f0c38c471fed98f583385e139e50b97c2a8f17256aac802d916ca75f1cc89a369cc0d947083e56ff94bbd297bc0cc382ee9d4b1237f02ca76a297cd9a181d8953d1a1441a12929c75b796cdac3449b06f1333c7c6c8bd114798b987299a8ef8aea95d757de1cb3f55090b0b51f6f823e7dfcaf6feb4e23fc3389dd5b33377cd73b04683dc3404c7e10f2ecf15dce7a87922b9c596e26452da347340baedc4ce6aecbaf503f5c2f2ad872da8445117a4ad146a4caf738c533f11bb01c7b03260af4df3298b8678e0ef640df65be6709408f1375722007fe17f0f42e434477cc359168b79469c013545e843ec14a47b90e5be1a6eeeb084010be924dd53624f78fac087e67dca7ddff961dd29a2bfb306d75d689373bfecbd1bf1f07be9acd84673a8f26bfc8bb4ab6158d8bb888559ae71116d7fde01474e66f2d4ccdd692379ce89b08d6305d70af89059701aca106a75f5f969c25aec82c5583deeb52c325eec6fb385bcda6d042efc74b3e6e0e22fab93b3187f5bb250fad3348ca0a4c99b80e18dcce4e552cc1d7fdc3ffa78159801445bbeb300a751b89d9cb29e9f86d7bb70e2bc61fbad9cea08c7cefe67ab0c8a60887157076cfc092ea6f87a8f58e23d23ba215d2478d4b55c38a4f763400377e4576cc240299a6b1db088bf2cb1ba874df698cdb473f37cc7479c40ad19be2b4b185c8e5b73774b7de3680ccf937eb53a7e7cd7d5a5d088ddb46a75c8ae2054e49c04e43ca2feac138e9780d350e44f4978dbe043f6daf56c2276a1e7fdd8887fc1e9c65a17606e487f65a2bb35b26d2c0611f1e0b4d4ce9c9b714172ae7f555e664f84865008a70c41da36d1f49f6892f93384f70f53112779039074217e9fb3d3d230143e4cc4a639de624295291e4d69032cc50a8ffb5a956852eb73dd6f8e32960ccd912aa4bb6dbf8cd453187ab8f60030cedfbf94a74c4bebb888c069d8289cef3c92883056b7bf9f0d354c1217ab8dfd430d6b70e14ae79dc5c8d44a82f8e78e8f5f66fa51f09aee94107406916d28db914ae88c883c5d16c3279ae068db23dea3645bbd1c529527d527c35648caaeda9db4cb4ef72998f715f0a05e6e205879d1f6c7eef2ad2baadbdb3a7d3bcf67eef659a3dc4f66f8dbda8360dbe2e44b6874111120b0c1383ca524ebe5e0885b07acf20b58dc8e31b6ab1316c3f386fac4a2afe201c6c09719f444562f13086bfd04fb79daa1efa37359a31e493c63f1b4963a61b1620f521c61b6d4237b175fada569d9f85850374f897e8b31d9bc593c53dcc5f5380cf232fc3c34b822381f65ef7ff09c298fa712b59ce55280f606916eda4eba7a484ed51006abd146b6bc3e36963ed700f83b537c24042118407214a5e3b9b8cf764b99d22f9b0b31b284aff9b311cc819349bc18e42f47a4f59f363b13e80ebd1b5cad78db8adbc4f37876b52f5e9116ca263559cafae72530bd310c6062e950befa1780b6a44a037e2a78200738f7109f5dc93eb606f1dc65b2a26eeda15903d032bfd026e3e0062cbc847dafc116e3dffae8f30301f2395cfa45902b168561fb8e62d64d8ac2d7e9db00e0c7a20b96ea3453f3d4a0e9b76b213fb2520f26a33717cf2eaad70608783db4fbde8e6c6a84a63adce4ace1c495d543a93801ec5d99f08ac17775810cff3851069a99a6da42c4019ec1e4826beb4554485c1242acf8d9c3ef5c02db7a150a87616aeffa251c0e0866fbc5692c5960e11ec0d1078e4a46e0f9f16e3ff30098f79ca273dc647f63d72f21f0c4458ce0c15070303325f354af383e02b3e8c4d30229bf7ef6544fabbc3183c6d4d37270f8477fb251c0cbcac80ad788252d2f47f3b1c548690b8b2f3e71c09076dcdf3a856ad05822185f2f1ff806aeb199136dc1eee835c06b4ed11803b9cfc84e5b272d716221d6f8d82e1a897</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请输入密码</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>KiCad导出Gerber图形文件</title>
    <url>/post/ef2c5f04.html</url>
    <content><![CDATA[<h3 id="KiCad导出Gerber图形文件"><a href="#KiCad导出Gerber图形文件" class="headerlink" title="KiCad导出Gerber图形文件"></a>KiCad导出Gerber图形文件</h3><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202405271719605.png" alt="image-20240527171958427"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202405271720173.png" alt="image-20240527172047054"></p>
]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>PCB</tag>
      </tags>
  </entry>
  <entry>
    <title>基于ESP-IDF在ESP32S3上移植LVGL和显示触摸驱动</title>
    <url>/post/64bc178b.html</url>
    <content><![CDATA[<p><strong>前言：之前基本一直在搞STM32的开发，想换到别的平台（比如ESP32）试试，也算对自己的一种锻炼和提升，注意到网上关于LVGL移植的教程非常多，但是大部分是基于Arduino平台的，基本没有基于ESP-IDF框架的（即使有也已经过时）。最近入手了几块ESP32的开发板和一块带CTP（电容触摸）的3.5寸IPS屏幕，可视角度和分辨率都不错，作为一个对GUI界面有执着追求的人，我想把当下很火的嵌入式GUI项目<a href="https://lvgl.io/">LVGL - Light and Versatile Embedded Graphics Library</a>移植到我的项目里，并实现一部分优化，让它即使在资源极端有限的情况下也能较为流畅地运行~</strong></p>
<p><strong>进度:</strong></p>
<ul>
<li>（已完成）实现正确显示 - 20240412</li>
<li>（已完成）跑demo、优化帧率 - 20240414</li>
<li>（未完成）基于SquareLine平台设计UI</li>
<li>（未完成）接入各种传感器</li>
</ul>
<h2 id="物料选择"><a href="#物料选择" class="headerlink" title="物料选择"></a>物料选择</h2><ul>
<li><p>ESP32S3开发板一块，比如我使用立创的ESP32-S3开发板（集成串口芯片）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122139635.jpg" alt="087b0e76d0dc9852b9dd31fb43531fa"></p>
</li>
<li><p>3.5寸电容触摸屏（显示驱动为ST7796U，电容触摸驱动为gt911）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122139803.jpg" alt="6dd6fbcc761ede3cc4c3065eba1070c"></p>
</li>
<li><p>杜邦线若干</p>
</li>
<li><p>Type-C数据线</p>
</li>
</ul>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li><p>电脑系统：<code>Windows 11</code></p>
</li>
<li><p>开发环境：<code>Visual Studio Code</code>（至于为什么不用CLion，因为CLion上没配起来IDF框架（抽象））、<code>ESP-IDF_5.1.2</code></p>
</li>
</ul>
<p><em>这里具体配置细节暂时略去，因为最近要重新装系统，到时候刚好重新配置一遍，写个教程补上 - 20240412</em></p>
<h2 id="开工！"><a href="#开工！" class="headerlink" title="开工！"></a>开工！</h2><h3 id="文件准备"><a href="#文件准备" class="headerlink" title="文件准备"></a>文件准备</h3><ul>
<li><p>先找到示例文件夹，在IDF的安装目录下<br><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121501913.png" alt="image-20240412150107877"></p>
</li>
<li><p>打开进入<code>./get-started/</code>，找到<code>hello_world</code>程序并复制出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121502899.png" alt="image-20240412150249861"></p>
</li>
<li><p>再在<code>./peripherals/i2c</code>中找到<code>i2c_tools</code>，也和刚才的<code>hello_world</code>放在一起<br><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121506011.png" alt="image-20240412150606976"></p>
</li>
<li><p>打开<code>Visual Studio Code</code>，选到hello_world目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121518948.png" alt="image-20240412151819885"></p>
</li>
<li><p>这里配置一下开发板的信息：<br>1. 插上开发板，点一下左下角的<code>COM1</code>，根据实际选择正确的<code>COM</code><br>1. 点左下角<code>esp32</code>，选择合适的esp芯片型号，比如我就选esp32s3<br>1. 选择<code>OpenOCD</code>的配置文件，一般选择<code>via ESP-PROG</code>就好<br>1. 点左下角的五角星，选择<code>UART</code>（我的开发板上带了TTL芯片）<br>最终配置好应该是这样的：<br><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121527778.png" alt="image-20240412152745759"></p>
</li>
<li><p>在main文件夹里新建一个<code>idf_component.yml</code>文件，并复制以下内容</p>
<p><em><a href="https://docs.espressif.com/projects/idf-component-manager/en/latest/reference/manifest_file.html">这个网站</a>有<code>idf_component.yml</code>的编写规则，这里我就直接用里面的框架了</em></p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">pkg_name:</span> <span class="string">&quot;pkg_version&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>浏览器打开<a href="https://www.espressif.com/">乐鑫官网</a>，在<code>SDKs</code>下找到<code>IDF Component Manager</code>包管理器</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121535817.png" alt="image-20240412153510715"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121546289.png" alt="image-20240412154657218"></p>
</li>
<li><p>在<code>IDF Component Manager</code>中搜索<code>LVGL</code>，这次用的是<code>lvgl</code>和<code>esp_lvgl_port</code>，至于驱动为什么不用<code>lvgl_esp32_drivers</code>，是因为这玩意的代码已经很久没有维护了，不支持<code>IDF5.x</code>版本和较新的<code>LVGL</code></p>
<p>这次用的是<code>1.4.0</code>版本的<code>esp_lvgl_port</code>，在<code>idf_component.yml</code>中把<code>pkg_name</code>换成<code>esp_lvgl_port</code>，因为我们这次移植的是<code>8.4.0</code>的<code>LVGL</code>，所以<code>pkg_version</code>改成<code>1.4.0</code>，把<code>LVGL</code>和<code>gt911触摸芯片</code>和<code>ST7796显示芯片</code>的驱动也加上，像下面这样</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">esp_lvgl_port:</span> <span class="string">&quot;1.4.0&quot;</span></span><br><span class="line">  <span class="attr">esp_lcd_touch_gt911:</span> <span class="string">&quot;1.1.0&quot;</span></span><br><span class="line">  <span class="attr">esp_lcd_st7796:</span> <span class="string">&quot;1.2.1&quot;</span></span><br><span class="line">  <span class="attr">lvgl/lvgl:</span> <span class="string">&quot;8.4.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>  然后编译一次就会自动下载相关依赖（这里即使最后编译报错了也没关系，因为依赖已经下好了，报错稍后再去解决）</p>
<p>  待依赖下载完成之后，工作空间的根目录会出现<code>managed_components</code>文件夹，把这个文件夹改为<code>components</code>（这步是因为可能要修改某些依赖的源码，如果不这样的话修改后会报<code>哈希不匹配</code>的错），把里面的依赖整理一下，像这样<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121647535.png" alt="image-20240412164748491"></p>
<p>  检查每个依赖中的其他关联依赖（<code>idf_component.yml</code>），把所有除了IDF以外的其他依赖全部删掉</p>
<ul>
<li><p>把<code>./esp_lvgl_port/examples/touchscreen/main/</code>下的<code>main.c</code>文件的全部内容复制到hello_world_main.c里<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121657456.png"></p>
</li>
<li><p>顺便说一下，如果VScode没法代码补全和代码跳转的话，按下<code>Ctrl+Shift+P</code>，搜索<code>IntelliSense</code>，选择第一个不带bootloader的，选好之后Full Clean，再点一下编译，就可以正常使用了</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121808911.png" alt="image-20240412180848835"></p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121809959.png" alt="image-20240412180922880"></p>
</li>
<li><p>编译一下，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121659815.png" alt="image-20240412165942792"></p>
<p>可以看到找不到对应的头文件，这里示例文件默认用的触摸驱动是tt21100，与我用的gt911不一样，所以我们要包含gt911的驱动进去，故要做的就是修改头文件，把tt21100的驱动换成gt911的，并且把程序里调用的函数进行对应的更改</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_lcd_touch_tt21100.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>更改为</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_lcd_touch_gt911.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>对应的函数改为gt911</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121815198.png" alt="image-20240412181507168"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121816895.png" alt="image-20240412181658868"></p>
<p>再次编译，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121820971.png" alt="image-20240412182013943"></p>
<p>注意到这里找不到<code>lvgl.h</code>的错误是<code>esp_lvgl_port</code>这个依赖发出的，所以进入该依赖的<code>CmakeLists.txt</code>，在<code>PRIV_REQUIRES</code>里加入<code>lvgl</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121821249.png" alt="image-20240412182143182"></p>
<p>再次编译，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121822908.png" alt="image-20240412182235878"></p>
<p>这里gt911的驱动报错找不到<code>driver/gpio.h</code>，与上面类似地，修改gt911的驱动里的<code>CmakeLists.txt</code>，在<code>PRIV_REQUIRES</code>里加入<code>driver</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121824523.png" alt="image-20240412182412458"></p>
<p>再编译，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121825244.png" alt="image-20240412182513212"></p>
<p>这里gt911的驱动报错找不到<code>esp_lcd_touch.h</code>，与上面类似地，修改gt911的驱动里的<code>CmakeLists.txt</code>，在<code>PRIV_REQUIRES</code>里加入<code>esp_lcd_touch</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121826592.png"></p>
<p>再次编译，发现可以编译通过了！（好吧，其实离能用还有很远）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121827054.png" alt="image-20240412182738026"></p>
<h3 id="硬件连线"><a href="#硬件连线" class="headerlink" title="硬件连线"></a>硬件连线</h3><p>查看开发板的原理图和乐鑫ESP32S3技术文档，应该按照下表接线</p>
<table>
<thead>
<tr>
<th align="center">屏幕+触摸</th>
<th align="center">ESP32S3开发板</th>
</tr>
</thead>
<tbody><tr>
<td align="center">VDD</td>
<td align="center">3V3</td>
</tr>
<tr>
<td align="center">GND</td>
<td align="center">GND</td>
</tr>
<tr>
<td align="center">SCLK</td>
<td align="center">GPIO_NUM_12</td>
</tr>
<tr>
<td align="center">MOSI</td>
<td align="center">GPIO_NUM_11</td>
</tr>
<tr>
<td align="center">RST</td>
<td align="center">GPIO_NUM_3</td>
</tr>
<tr>
<td align="center">DC</td>
<td align="center">GPIO_NUM_9</td>
</tr>
<tr>
<td align="center">CS</td>
<td align="center">GPIO_NUM_10</td>
</tr>
<tr>
<td align="center">BL</td>
<td align="center">GPIO_NUM_46</td>
</tr>
<tr>
<td align="center">I2C_SCL</td>
<td align="center">GPIO_NUM_2</td>
</tr>
<tr>
<td align="center">I2C_SDA</td>
<td align="center">GPIO_NUM_1</td>
</tr>
<tr>
<td align="center">CTP_INT</td>
<td align="center">GPIO_NUM_45</td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong>注意：VDD和GND千万不能接错，否则烧毁！</strong></p>
<p>接好线后烧录刚才的程序试一下，然后…咦？屏幕怎么没反应呢？？？</p>
<p>原来是接线没有在程序里映射出来，这里修改<code>hello_world_main.c</code>的第24-50行为，在不同硬件上需要做相应调整</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* LCD settings */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_SPI_NUM         (SPI3_HOST)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_PIXEL_CLK_HZ    (40 * 1000 * 1000)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_CMD_BITS        (8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_PARAM_BITS      (8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_COLOR_SPACE     (ESP_LCD_COLOR_SPACE_BGR)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_BITS_PER_PIXEL  (16)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_DRAW_BUFF_DOUBLE (1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_DRAW_BUFF_HEIGHT (50)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_BL_ON_LEVEL     (1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD pins */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_SCLK       (GPIO_NUM_12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_MOSI       (GPIO_NUM_11)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_RST        (GPIO_NUM_3)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_DC         (GPIO_NUM_9)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_CS         (GPIO_NUM_10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_BL         (GPIO_NUM_46)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Touch settings */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_NUM       (0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_CLK_HZ    (400000)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD touch pins */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_SCL       (GPIO_NUM_2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_SDA       (GPIO_NUM_1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_GPIO_INT      (GPIO_NUM_45)</span></span><br></pre></td></tr></table></figure>

<p>改完之后再次烧录，发现屏幕不断滚动报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121851092.png" alt="image-20240412185134048"></p>
<p>看红字知道报错是因为I2C总线上没有找到gt911，这就比较奇怪了，难道是因为I2C地址错了吗？幸好乐鑫提供了一个专门的I2C检测工具，可以遍历所有I2C地址，还记得和hello_world工程一起复制过来的i2c_tools工程吗，现在需要用到它了</p>
<p>在VScode中打开<code>i2c_tools</code>工程，编译烧录，在终端中可以看到进入了<code>i2c_tools</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121938181.png" alt="image-20240412193813115"></p>
<p>输入<code>i2cdetect</code>即可遍历总线上的地址</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121938576.png" alt="image-20240412193850546"></p>
<p>这里出现了<code>0x14</code>，当前挂载在I2C总线上的只有一个设备，所以gt911的地址是<code>0x14</code>，然后我们回到hello_world程序，打开<code>/components/esp_lcd_touch_gt911/include/esp_lcd_touch_gt911.h</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121942008.png" alt="image-20240412194202971"></p>
<p>可以看到定义了两个I2C地址，在结构体中调用了一个，这里看到调用的是<code>ESP_LCD_TOUCH_IO_I2C_gt911_ADDRESS</code>，值为<code>0x5D</code>，与实际地址<code>0x14</code>不符合，而<code>ESP_LCD_TOUCH_IO_I2C_gt911_ADDRESS_BACKUP</code>的值为<code>0x14</code>，所以结构体里改为<code>ESP_LCD_TOUCH_IO_I2C_gt911_ADDRESS_BACKUP</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121944838.png" alt="image-20240412194432812"></p>
<h3 id="改代码"><a href="#改代码" class="headerlink" title="改代码"></a>改代码</h3><p>再次烧录，看看效果__结果还是不行，还是报I2C的错误，这里我们查看原理图，发现屏幕的I2C没有上拉__，所以我们需要打开芯片的内部上拉</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121954480.png" alt="image-20240412195427450"></p>
<p>然后再次烧录，屏幕成功点亮，但是显示有点奇怪</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122139981.jpg" alt="0f0e9dbd753c2ea81331be530d4058f"></p>
<p>现在发现：</p>
<ol>
<li>长宽不对</li>
<li>字显示不清晰</li>
<li>屏幕镜像颠倒 </li>
<li>触摸X、Y轴反向</li>
</ol>
<p>现在开始逐一解决：</p>
<ol>
<li>设置长宽，更改宏定义里的<code>EXAMPLE_LCD_H_RES</code>为320，<code>EXAMPLE_LCD_V_RES</code>为480</li>
<li>点左下角小齿轮，进入<code>SDK Configuration editor</code>，搜索<code>Swap</code>，找到这个选项，打上勾（改完记得保存）<br> <img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122005348.png" alt="image-20240412200541312"></li>
<li>这两个<code>true</code>随便改一个为<code>false</code><br> <img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122021990.png" alt="image-20240412202126956"></li>
<li>把结构体里的<code>mirror_x</code>的1改为0，<code>mirror_y</code>的0改为1<br> <img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122047197.png" alt="image-20240412204715167"></li>
</ol>
<p>然后再次烧录测试，发现颜色还是不对，背景是黑色的，但是理论上应该是白色<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122138345.jpg" alt="c4ae5d37df49d5748cd673873cdaece"></p>
<p>考虑到屏幕的面板是IPS的，而默认显示驱动可能支持的是TN屏，我这里选择魔改另外一款默认为IPS的显示驱动芯片（ili9341）的驱动程序，具体操作如下：</p>
<ol>
<li><p>通过<code>idf-component</code>下载<code>esp_lcd_ili9341</code>并移动到<code>components</code>目录下，并修改<code>esp_lcd_ili9341</code>的<code>idf-component.yml</code></p>
</li>
<li><p>修改<code>/esp_lcd_ili9341/esp_lcd_ili9341.c</code>的<code>vendor_specific_init_default</code>数组为（这里是参照屏幕厂商的驱动改的）</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="type">const</span> <span class="type">ili9341_lcd_init_cmd_t</span> vendor_specific_init_default[] = &#123;</span><br><span class="line"><span class="comment">//  &#123;cmd, &#123; data &#125;, data_size, delay_ms&#125;</span></span><br><span class="line">    <span class="comment">/* Power contorl B, power control = 0, DC_ENA = 1 */</span></span><br><span class="line">    <span class="comment">// &#123;0x11, (uint8_t [])&#123;0x00&#125;, 0, 120&#125;,</span></span><br><span class="line">    &#123;<span class="number">0xB2</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x0C</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x33</span>, <span class="number">0x33</span>&#125;, <span class="number">5</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xB0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>, <span class="number">0xE0</span>&#125;, <span class="number">2</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    <span class="comment">// &#123;0x36, (uint8_t [])&#123;0x00&#125;, 1, 0&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;0x3A, (uint8_t [])&#123;0x05&#125;, 1, 0&#125;,</span></span><br><span class="line">    &#123;<span class="number">0xB7</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x56</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xBB</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x14</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x2C</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC2</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x01</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC3</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x0B</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC4</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x10</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC6</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x0F</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xD0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xA4</span>, <span class="number">0xA1</span>&#125;, <span class="number">2</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xD6</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xA1</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xE0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xD0</span>, <span class="number">0x08</span>, <span class="number">0x0A</span>, <span class="number">0x0D</span>, <span class="number">0x0B</span>, <span class="number">0x07</span>, <span class="number">0x21</span>, <span class="number">0x33</span>, <span class="number">0x39</span>, <span class="number">0x39</span>, <span class="number">0x16</span>, <span class="number">0x16</span>, <span class="number">0x1F</span>, <span class="number">0x3C</span>&#125;, <span class="number">14</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xE1</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xD0</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x21</span>, <span class="number">0x32</span>, <span class="number">0x38</span>, <span class="number">0x16</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x20</span>, <span class="number">0x3D</span>&#125;, <span class="number">14</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x21</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">0</span>, <span class="number">120</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x29</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x2C</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>至此驱动修改完毕，在<code>hello_world_main.c</code>中include一下<code>esp_lcd_ili9341.h</code>，把<code>esp_lcd_new_panel_st7796</code>函数改为<code>esp_lcd_new_panel_ili9341</code>，烧录看看效果</p>
</li>
</ol>
<h3 id="正常显示-20240412"><a href="#正常显示-20240412" class="headerlink" title="正常显示 - 20240412"></a>正常显示 - 20240412</h3><p>可以看到，已经正确显示了（但其实旋转方向之后显示还是不太对，屏幕会镜像，不知道为什么，应该还是驱动的问题）<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122138205.jpg" alt="61e5f02c1fdb5e1fd49e2a5a34a134b"></p>
<h3 id="跑demo-20240414"><a href="#跑demo-20240414" class="headerlink" title="跑demo - 20240414"></a>跑demo - 20240414</h3><h4 id="Music音乐播放器demo"><a href="#Music音乐播放器demo" class="headerlink" title="Music音乐播放器demo"></a>Music音乐播放器demo</h4><p>点左下角小齿轮，进入<code>SDK Configuration editor</code>，找到LVGL相关的设置</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141416848.png" alt="image-20240414141602770"></p>
<p>在<code>Demos</code>里面勾选<code>Music player demo</code>，别忘了保存</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141417085.png" alt="image-20240414141718058"></p>
<p>然后回到hello_world_main.c里，找到函数<code>app_main_display()</code>，将里面的<code>Label</code>和<code>Button</code>注释掉，并在后面加上lv_demo_music函数的声明和调用</p>
<p><em>这里补充一点，C语言可以在函数里面声明函数，格式与在函数之外相同。 声明后的函数只在本函数内调用有效。其他函数需要重新声明</em></p>
<p>修改好后的app_main_display()函数如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">app_main_display</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">lv_obj_t</span> *scr = lv_scr_act();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Task lock */</span></span><br><span class="line">    lvgl_port_lock(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Your LVGL objects code here .... */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// /* Label */</span></span><br><span class="line">    <span class="comment">// lv_obj_t *label = lv_label_create(scr);</span></span><br><span class="line">    <span class="comment">// lv_label_set_recolor(label, true);</span></span><br><span class="line">    <span class="comment">// lv_obj_set_width(label, EXAMPLE_LCD_H_RES);</span></span><br><span class="line">    <span class="comment">// lv_obj_set_style_text_align(label, LV_TEXT_ALIGN_CENTER, 0);</span></span><br><span class="line">    <span class="comment">// lv_label_set_text(label, &quot;#FF0000 &quot;LV_SYMBOL_BELL&quot; Hello world Espressif and LVGL &quot;LV_SYMBOL_BELL&quot;#\n#FF9400 &quot;LV_SYMBOL_WARNING&quot; For simplier initialization, use BSP &quot;LV_SYMBOL_WARNING&quot; #&quot;);</span></span><br><span class="line">    <span class="comment">// lv_obj_align(label, LV_ALIGN_CENTER, 0, -30);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// /* Button */</span></span><br><span class="line">    <span class="comment">// lv_obj_t *btn = lv_btn_create(scr);</span></span><br><span class="line">    <span class="comment">// label = lv_label_create(btn);</span></span><br><span class="line">    <span class="comment">// lv_label_set_text_static(label, &quot;Rotate screen&quot;);</span></span><br><span class="line">    <span class="comment">// lv_obj_align(btn, LV_ALIGN_BOTTOM_MID, 0, -30);</span></span><br><span class="line">    <span class="comment">// lv_obj_add_event_cb(btn, _app_button_cb, LV_EVENT_CLICKED, NULL);</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">lv_demo_music</span><span class="params">(<span class="type">void</span>)</span>; </span><br><span class="line">    lv_demo_music();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Task unlock */</span></span><br><span class="line">    lvgl_port_unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们编译试试，看会不会报错<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141423001.png" alt="image-20240414142329954"></p>
<p>还真报错了，这里说的是找不到需要的字体，点左下角小齿轮进入LVGL的配置界面，在Font usage里勾选上12和16号字体，记得保存</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141424111.png" alt="image-20240414142453070"></p>
<p>再编译试试，可以看到已经编译过了<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141429970.png" alt="image-20240414142923937"></p>
<p>那就烧录看看效果吧（这里有可能触摸的X或者Y还会反，再去改tp_cfg结构体里的mirror_x或者mirror_y就行）<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141435341.jpg" alt="0396dc12365b70b64f1728d4a349420"></p>
<p>可以看到显示和触摸都正常了</p>
<h3 id="跑组件（Widget）demo"><a href="#跑组件（Widget）demo" class="headerlink" title="跑组件（Widget）demo"></a>跑组件（Widget）demo</h3><h3 id="优化帧率-20240414"><a href="#优化帧率-20240414" class="headerlink" title="优化帧率 - 20240414"></a>优化帧率 - 20240414</h3><p>打开<a href="https://www.espressif.com/">乐鑫官网</a>，点顶部的Support，在找到ESP-FAQ，搜索LVGL，即可找到如下内容</p>
<ul>
<li><p>Taking ESP32-S3R8 as an example, the following ESP configuration items can improve the frame rate (ESP-IDF release&#x2F;v5.1):</p>
<ul>
<li><code>CONFIG_FREERTOS_HZ=1000</code></li>
<li><code>CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240=y</code></li>
<li><code>CONFIG_ESPTOOLPY_FLASHMODE_QIO=y</code></li>
<li><code>CONFIG_ESPTOOLPY_FLASHFREQ_120M=y</code> [should be consistent with PSRAM]</li>
<li><code>CONFIG_SPIRAM_MODE_OCT=y</code></li>
<li><code>CONFIG_IDF_EXPERIMENTAL_FEATURES=y</code> and <code>CONFIG_SPIRAM_SPEED_120M=y</code> [should be consistent with FLASH]</li>
<li><code>CONFIG_SPIRAM_FETCH_INSTRUCTIONS=y</code></li>
<li><code>CONFIG_SPIRAM_RODATA=y</code></li>
<li><code>CONFIG_ESP32S3_DATA_CACHE_LINE_64B=y</code></li>
<li><code>CONFIG_COMPILER_OPTIMIZATION_PERF=y</code></li>
</ul>
</li>
<li><p>The following LVGL configuration items can improve the frame rate (LVGL v8.3):</p>
<ul>
<li><p><code>#define LV_MEM_CUSTOM 1</code> or <code>CONFIG_LV_MEM_CUSTOM=y</code></p>
</li>
<li><p><code>#define LV_MEMCPY_MEMSET_STD 1</code> or <code>CONFIG_LV_MEMCPY_MEMSET_STD=y</code></p>
</li>
<li><p><code>#define LV_ATTRIBUTE_FAST_MEM IRAM_ATTR</code> or <code>CONFIG_LV_ATTRIBUTE_FAST_MEM=y</code></p>
</li>
</ul>
</li>
</ul>
<p>再加一个<code>LV_DISP_DEF_REFR_PERIOD</code>由30改为10</p>
<p>注：如果要显示帧率和CPU占用，可以吧<code>Show CPU usage and FPS count</code>勾上</p>
<p>这里就按照官网的推荐来进行修改，点左下角小齿轮，分别修改上面的这些参数（修改完记得保存），其中某些参数可能找不到，这是由于CSDK的版本和使用的MCU型号不同导致的，不用深究</p>
<p>修改hello_world_main.c里的SPI频率到80M（实测这个影响帧率最为明显）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141458859.png" alt="image-20240414145809827"></p>
<p>改完以后再来编译烧录，发现帧率提升了很多，滑动较为丝滑了</p>
]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
        <tag>LVGL</tag>
        <tag>ESP-IDF</tag>
      </tags>
  </entry>
  <entry>
    <title>开箱Sipeed的SLogic Combo 8，多合一开发调试工具</title>
    <url>/post/e3aef73e.html</url>
    <content><![CDATA[<p><strong>写在前面：今天刚拿到一个好玩的小玩意，SLogic Combo 8，这是一个集逻辑分析仪、四组串口、DAP-Link、CK-Link为一体的开发调试工具，刚拿到就迫不及待地试玩了一下，发现确实好玩ლ(´ڡ&#96;ლ)，进一步丰富和简化了我的工具链，希望可以用的长一些</strong></p>
<h2 id="开箱"><a href="#开箱" class="headerlink" title="开箱"></a>开箱</h2><p>打开包装盒，映入眼帘的就是SLogic的主体了，整体设计的简约大气，通过背面的隐藏式按键和指示灯可以知道当前在哪个模式下，同时通过面板可以知道各个模式下引脚的定义，这点设计的还是很人性化的，并且提供了3.3V和5V两种电平可以选择</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404140028088.jpg" alt="580570c6cf3dfad75f8fe9e0e9619f9"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404140030172.jpg" alt="3ee0e225bdfe8fa4c53dd99e7eabd3f"></p>
<h2 id="试玩"><a href="#试玩" class="headerlink" title="试玩"></a>试玩</h2><p>没什么好说的，标准的串口、DAP调试器，不知道为什么DAP虚拟的串口经常会卡死，逻辑分析仪要用魔改过的上位机</p>
]]></content>
      <categories>
        <category>开箱试玩</category>
      </categories>
      <tags>
        <tag>逻辑分析仪</tag>
      </tags>
  </entry>
  <entry>
    <title>舵机多功能测试程序说明</title>
    <url>/post/cee333e2.html</url>
    <content><![CDATA[<p><strong>写在前面：基地一直都有对舵机快捷测试的需求，但是每次都得改源码，很麻烦，也不能实现舵机的精准角度控制，最近忙完期中考试，抽时间写了这个程序，也算是对学到的东西的一点小小的应用吧</strong></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本程序运行在大疆开发板C型，基于STM32 HAL平台开发，具有极其优良的可移植性，可以快速迁移至其他MCU，本程序依托串口与上位机通信，使用时接串口线和电池即可</p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404301832725.png" alt="image-20240430183243677"></p>
<p>对主菜单的解释，每个指令串口都会输出对应的注解，<strong>注意输入任何指令都需要以回车结尾！</strong></p>
<table>
<thead>
<tr>
<th>功能</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>Plain Servo Test</td>
<td>朴素舵机测试（控制舵机转到特定角度）</td>
</tr>
<tr>
<td>Interval Servo Test</td>
<td>区间舵机测试（控制舵机在特定区间转动）</td>
</tr>
<tr>
<td>Quick Servo Test</td>
<td>快速舵机测试（快速测试舵机好坏）</td>
</tr>
<tr>
<td>Use Multi Channels</td>
<td>使用多个PWM通道，可以一次测试多个舵机</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>STM32</tag>
      </tags>
  </entry>
</search>
