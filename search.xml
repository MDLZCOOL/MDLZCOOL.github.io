<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Windows下Clash for Windows使用教程</title>
    <url>/post/5d67cfa0.html</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码有误，请重试" data-whm="解密的内容无法被验证，但仍可阅读">
  <script id="hbeData" type="hbeData" data-hmacdigest="2d37cef5232bd689e98cd4470834fa4d6689d840be531becbf5fee74996aae9a">f486ad9ffa4b01bca5f2d6a44c783b6260a25d706d0792afaf5549cdd484ce67e2fc78cf35a7049c8de715ca4edd8e6b05b6a86a9a4e9448dff1313ff28440d6b17686204dd7580c1cc13d47f6beddbdea101b3824c470e44d7cc816fa0db21ae3ef7a9edd5f20798918a619cbd5022b1e1a1f186e26ab8f6a7325158525a5efa5d2827f7c0b36370e232b03260fe889bbf6464ae79fb3ab5999afd2f7ff0b92f9380d678566541cbd6cd6e0e2de5d39195200401659514842f1e185ede740f49f6a9b8266a594418804b774e6f437ad4fa738755541a6bcdd48147d2573a753975309384ff86aa3f7f687ccca037a0dcad0401a54642b2faccde57de71e4f74f12222f6dbeaa251fb9fa55448561ebd25011ebc94aa1dc2aa0b54f0957f193f39559b8cf307f6fddde8545c3125b6311a18da895d5ac33b0883ac02f3f5dd6fdd04c451065863da2115d1cde562e1fd2a85db034353d0ba9a05a85a96ac0048c5b7b3756f7b450a0c419f8f284cc0ddee0834702907bf48760c8f4bb851182128780a87596f76229eb7aa929df660d631c9a5228bc93d5a1e0332457f9c44d5f2a4d5abdfc270f73bb67169c1cbc7b7535540263552c827f3da9f4638e9fc8bc672accedafdf649bdb93cfb56e598287e994e84ca9135fc19751c0b1efda4dda8ae22a098a1bb4dbb006c59ebd4f445eb7eb3e3424ddda94a18bc9f4662ee29fb6229902b09ceec04f6f7d3c992295a1892e51426d226f811714d612b3c6b3ad6c528331820686db01b9b85125a5615d0d73977adb23b9b5290a2800ce4780f24d86132df0f9058f7e725c2e205cf3bc2fb33c511af065784f00cfc7d7fab56064c91d15bb5abd57c2cdbadd0fd3d750f6091e9934f7b773f60a9cbd03c7cf285f898c30eb26e7babdf1fb0f3a3bfeeb1aa64a34d60190ad4ade7d4ab89aa5465017760d4b678b6d38a4aeaaa61a6865293f246cf0001308ae4b6a8917d0887b26f5d60eb78628c504a8ddd2ff74cd951ab3ca9a1d3c1f983b1c580ec301d6af519a855cef23b818357c5f983c774201a23e07354de6ea16878ec7cb7d02b8b06de2a1714f47f1aa0985b6255a5629723138aef62cccadd7d995c5d189a8b96d837f5ffd22480c35e52d251fbbaa08c1b092ec31745eb4e54f5bcf2b0e1e5fd54357ee978b2a16cd8aef6236dbafa1e8eff827d426b8f0a30e731415c0a1ad84268f1e75e07711fa30fd1bb449458c864ab4dedffbb2f3968f4834dcb086a4114758e0e8ffa717d0e465d012a2fb662168c75fd0b038da3bb647b2b91db0469d60c1a3fa5d495e1eaecf02c7036d0ce4fda4ecdab90b4038e56d3961b0dc81bd522e98ff3d41ab852c1bcbbb030628c4d54c631c4f88f2a2502004c14c07cfcc557de28cc50228f44323ba5e4a4f7fa380689feccc4004772725956ff12646b472d0923b5ba012fc53ce6778e0e01cc269df7341eac7de2b3b7cb2710b865d740dd66aa6b4960e845356a5d21ccfb5b3b82a80237be7f10948a6bba6da632c7d08789ad4e1f201f6aedbe4ede355c69d2d928092be00dda956453673bc117d4578d865e6759cb823f7db395704cbfed51303fa9ff0a7981a8339e4ec07ecd762a95ab00dc3e84a4ed125401a0a7e7f50c562bf58ea6ed3e78bab14fb7aab6928f774c50d1937fe37443b44771f4e29552f256248241a660435ba5e93ca940930af85bb49e71f91587eb15fab85e038ccb2393ad347e5c8b8b39a2b602aa095b6f5165fb0a39bd07421dd3aeedd4e2943c81d3770ac657fbd8b9b3a8864c01ec9e6d0eb7f258609e1b3e808a9f22ac854db931f3608841c964f971f281289688096ea6ab0a12ff71374db703a918f055817279cf6608e2f3e1e82c12d3e4c0267d451218a0858debc0cfdf9e6e4a94ca8bdc50c78f96ff6fc628fcec76fb2c6add6b7582d888440076536311f4f52649cd66c95cac8114ec01438701ec59baaa9b8dee6f5dffbcb7b1578945b2ba96642a92b10049bedf137ffaadf8b8a2f93461179dd1fa934601566aeb372b6a44f734297a845169d8b1af5a9ef6c527a2e30e983cf296cf58bb9a2b2c0e489d836a272fcea364907bdfdd5f6ed804705afa878b2add1a56d06ecd78cd99ac7fae15c3a3dcb539da242a160b729fbb5c2c3192d32ff8da9ebc73867f4e2d6c7f54be6ae4d37be8fe7bc8c6b5964c128e28aa3f00e614f09b890e8c992937109bf567400d1e22718173832b7fdd50f204ab69e379182e64ce1e6f6068e6bd2867e223f8860ff6fc29eee81d9dd77f574b3931888fb2f460a99bd65f06ad567c5c93d9ba56aed79e05d4e09fd3d4cbce68e8b93de45a0c08f57262eff7c2ce80aad69968e101816f80fa7e770a5a21a148a7432307aa1f54b01ca1088f57899de673c68458bbe845f54c3fbc735df991b24f8944dcd61716fdcd672fbac5e9a213fb87f4753684a7d129377be2860f378b311057a0a8b61971401c803326df8e1cb33e4c5265cff45f6e66621de393ca85a29f641916e44f7bf3d8bd6d803de182653e6d663ddc321fdcf7c813e082a563b4537404baaa5866ff55b50d39f48c144442b20d60aec1f2b6a8b90733b24b7abd21460f5dbd9f6ec79d4bd2bb1243a4b1e81c0934ddabb2ada801b130304be5b714516a532463939fc2c047dca0e82c3c86718eca464100890f4bafb9eed4f1f3e64c67a262ae840d381f8981e0779e3401d72acb99660dec268bf900afef7a879cd2c4ec690becca29b8d555a073f3d0615283e9f1b1a7f7408bc3ac1b907eb50d8a885cb7528cf5d8b39a52210065a3a04bc09fc599af8eae534059c990fb08e9357ba51195a3078768e708e9d8ec25b28a99d2832c62340a21c3c3c25fb9ab45372b6837a34c070b2e892afc7b118906e5e02d365b706cbd0b4a76486ad92207bfce13be08d1d2a763f6372a72a184eb029ec8a7922e792f978b217a12e4aaa28255ac7bc67f17d644e030c0219dec4be73ebc03cceff7cfe07afb1b0233a2e6668671aac22a9e49833da0ca500ffb8d3d37b9363ce49bebcde213ae23ba59c171663ebb1f2e5f0d818704b935737ef0bda4aa489454f5e13bb770cbd83e34edee4de04b15fd88b020f03275c5f80896b2c148b51a2bd5144ee8fed626eafb0276e7346f6341ad3fb3750b076df2aa0e46eb720fdf18515a8b3bb87f3397952126d4cbccab0b40963d27976171a6a16c9f3bf3ca7d33610d5d3dd5455ebd306182543352d6b626f61f11667f8f5c54a1ba8cb3743e7d3e2c2be2b2858725b387ad203d96d8b0de1bc0024ee9c198ccf098df4f7281ad1a8c345a9bf9c1f8d2aa89fd2887a4f4c749ef65d3fa2e3a675cf004a10dbdc322f402f5ff3503d5187d59befdaba535dbb83e77a0e4a71267a24ad11797ec857ff0ae609173ce0ea62a3e2dbccef8a1c8a6d0f7a18ceb205ab0b4c8daa9a3f14ad9f0d5138da62cda488edc1398d7061561f90cb1f41ce433610318fd9f65fd4161611ef13875a6aeb232e622a2a2a9732b884c18fffcd49d2e51b684b70557c2c9b4b6ff1cc9d8048462ff6790176e7c80b56814f3dc9c6e57c24ccc85fd6b60e5680aef453530ad8efc0ca1724044530266677a435490eae5793d44d8ff18a49839b8f63f48d12ce85124b1004ed6e6da36b490a191c44e05e160a7264bd25b6b1fd1cfe3bec277545f0f4a85a8978b0d9833f3e388d667f2ca58a1aeaa251e0efa10e9c5f3762d98bdc77faeaac8d3ed85321091c739266b660f9a8de73face1ba175bdcfc8dd4c98911d7ec51f3c3e97dbee2d086ff65f8e553d380d6e6d061cbc8d6101d13b4fab0ab31dafb3f8c3e3555457af05774d1a7bf943500314a300c9779024a67e2a6f0531c95f51ffee1e1805912f70bfe5bd9e244fd71b9dd2f237d8542b4ffefa20585f19cebdfa74d49f4e0f5ab6c7f062be3a4ea7b02a8c9fc7daef0bfaea1489b86f100d5418b521a27daac75af106a13894713280b7dff6abb862f34b35fc5004e4a63e4f9bce64fa0381d56e92110e78e3504571cd300777a600a66fb25392cdf2e086dda35f341343a510599f70a7d087e95b6df5c484211f2314cae93a89aa216f3ee6dc085a2eaddcfb6c7a97e7932c0d97060839c098b15b41b3f04a3182aa8df3fb5fd6bf2a8ec5fd638b6ecfc4395e02893431c2a9aaab1128884ee7839a124a9a4be928993c87b41c258fbf7ddc81ab11cc7c8334a175feb9f8392d27d8bd9e72dccdd98fcf932daecb72397eeb2fe4cc5c60164c11061d2c117dd47bbcb67010c0a5ddc05882fcfbc307d534cf73bfdc61c1dea75160a0cc5af0741ae21e22ac4447b990f8022d47b8b87af06e7520cae8ffd98b6c2262241875af027b7a3f2e8c156e5d7790dfff1e0952c31c9ff2a1bdcf82427361480e3d05b1e2058f180613827c17e12191de395cf11702c50f7b79b29c896f69bb195095bc2de90bde8f53abebc4018fb0d4b2a363c7ca07440360501944e6560590a7597d57daee13dccb18eaeb11ba977ddaaed41d875b0823b4fbe82a34114b68f36f51bba48c57d1744c8a80654dd73462d74c68dd806434e444d91f76f9f758e6b44bdf96a1ddad4f0cb6f68ffe7fb3e4f3fccbf3b280c69101c27b98c026afe5cd1a8ec1fa77f5ba0d0b95c9b508d683555bf9945166ea51ffdbcc56e6c6e4fd965c0d557a7aedbd22d5d69ad494ef6f5805551f9d82789d4671b632e262bd1a9ad60094868040d062807046ef85ca559a1f8c905f149d7c921b7370ccea1896a7276b2f1b9a0b699dee3336e33cf1f6a7adb13276fab465707402b71c66be4b5f64b03444f30aaa5be55bd4698509cbc1541f76dfa5260408031b232cc8fb7f5b27beaaa71f66920a84a01bf8ca14ce14362727ebda5e2b7a58fcc19b719b1203300cfd0723e4a6bf7412d4b1895deb22dc1199c188920a23e1e3187d6163d33aa08110a5fc9108d253886dcf2004dfff5284209801edd2f74cb1f854cbc171826e59cb2571ea428f5d046ce8e7e1dfce1c6981a9ac7c5a5d30b85b2b2e4ae8a253fcb3ec5f932d1663e40d3096f8d7893276bb7dc5a3dcc983d492f65763cb7e2a34c59a9e190b2e63a17a294b3f6995b342b34608f30ce062d61e55d3412ee459533e10aa867998d73997b0b43868f4e00f17d60896ed8e09dc45573451700200ed15470be2dba167493d745b2fae9c3d90344394e7e90d471162f969d6470d66014c08971a61e5057511d16f93eb036c87355a57a7e49937b626ad12e70c0c34158fbe7f78529f99459daa14df921c2f861ba38824e16e20aec5a72827f4991d0ac0ffbc31ffce5df285f7f41dc007ee07fcf82b612eb5e43ac95aa81416af4bd1a71995fe49eda37f1d03fc763c95921300a1785a38c65b731260ebe1e4b6f3f5b901090e02cb86fcc56072b1f4002f17110bd17e4a366703f192f5367a1b2c029c24cd89a32a121ac5c67f1751089fcfb6a79707f6f06537bce476ae1508e623ad5f3c21b2edf25e8e5e657e1179c881892eb0f202a0ece35f501bdf9a10d26a01de6bc893f2679655e78ab68e69250ac4a04192b92dfda351d9c1a4c40830d832ad6cd13b6b3065186a02ee4f8932ca4d824e5562a2360207d28492e0ac80aa94d45b98e778959bf49d48d631b741cad9276dbb8a3b49cebf0514ae1b524928cc58dea90684fb40a9da2562109a74a657c67c7782941cf405e709f2e3767955bd87aeba1d92a35ed143c5d652d23c9f63023c2b83f8eb1842f0f3b910498493c74608c5f9383342e873f512775d2a1176821471a93663ec1e54c2a4591775c8080b490f4848ad1d987b22810c87259b10f585842496659453f1cf4c84ae6b133368215f3dfb2d38101d3b9a827928391778aa86a6df67c25b4468bad2956458320a8318583cf6a07ed5c235b341638befabb905bde192cf65c18202fa093cc7445a84502b0932f2af3afc4f95825849f4301bf3376d7291900c4c7ff1030928a107c038f80ada3c0bb52c22395e1495f1111ce8eb355be2030fda828bb0834cfb3e7eb2113b9bac7e197e3ad21d153c74ca3f28a80e46692a8413813a29ec6edac445aa84f7ea82acc8739c698753ad5f9f9c860bff0f69356c2dd06d41f22ff7612f1183ab399f61aeeda926675756c0a23b0c6b0fe5e0a7d27bc9296adedc9cdd673db1be4535029abfd7dbec2b710302e6e2912cb7180ef3d9a0f2d7d3fe3d5a88cc12c729b4093a2c443a4aee67437f5ea430abc03cd75b6f94f7400e0b4e8ef32002113ac892d1f3a093f5c1dc94d3d10c03e87e896326942478bc3247d6b055fffaa01f9a690832b2f7221d41e0d1d6e5d7e6e515b72dcfc67ff361740e4e9233370a6de94e763a4a7a8da3cd5d0b63878847e96baf29e85ab81bee2620325ec954c670e6385068de8b6fb75a0e2103845b6cee74cd4a5f4620c8316844b039d227864c90f6353a97ee8cf41cd7ea216546305db7db61bbd310e78f877edbad992fa9b0d46e5955a104be61fff8c337a11b0ab95c74c8d636ca51b222184669dad210f4197d24289ad348c2c872cafe8f97c87882043c2cdf2a7c7c20fc04a5f0fa201ae2cc9124cba99fb981ccfa24474baa5f2f7123e9ba4f1aa702fc495364bd09ec649933d907a6becc74d11baaed96d61d00faeef14a9fdd3fb142083b0ba310bb8d8e8a601f07418880c99ea48d655d294e7e41914bd9ece63acb98c29ce5e9dd57dc248e5d3772645b5a0d653aace45302a946dae7b75fd0dc52a7575182ae77379efd963ec480ba520e623bd4308f120c947b6d4cc414ee0e84d491011ef9f09c8b1af8f9410b9170a0646b0920651e96d7ecec3e6f687f44228cfefdfffdc4cb7f28bffa9d28abcb613cfb130e3d203b63ec6f52401d91915c24dd4130ef49ff9bbb395a9c66ea1a0dbc70618322b7073aa7493c30a7c0cd9a3d79b2e52b7baf4127ddaf8bf544c491bd9cdd5d00152571a3e10652ec9b172168a25d7704dca81c72dee8311a99dac28bb2e48e912dbe7433e0cac8508a3cb689b20b02f5b9e74a948ca89da367705a5df3ce687dd77c4e185041ea766ad5f538ef0b6475e2a12754e94a7de0ccf9092c3cfed37f8807d590984ad4ae8b412f48a1b067689848e989936aa1840047a2bd77f57515f87f0bc4397affd4bb56e036948ceb557fb4589f37f5934257c235415606cd4854142d15d195053daa384df0a3793baaa791635956295e7e574f22b7e5ca9c24598bc018d8a8e732b01d639c8ed75eff894bacbeb9eac9747d1b0587c27fe539763a18ca01e25594971d3a31757bee864f66c456c970053ce2fb109221e34a8b0eed9ed37052b3e0ad4e851d51d7374f8ada64d18496cfd1cf4d26a24da46d1d37051e5503d8290825249379804442c167c6e6f48159f6ee0</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">请输入密码</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
  </entry>
  <entry>
    <title>舵机多功能测试程序说明</title>
    <url>/post/cee333e2.html</url>
    <content><![CDATA[<p><strong>写在前面：基地一直都有对舵机快捷测试的需求，但是每次都得改源码，很麻烦，也不能实现舵机的精准角度控制，最近忙完期中考试，抽时间写了这个程序，也算是对学到的东西的一点小小的应用吧</strong></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本程序运行在大疆开发板C型，基于STM32 HAL平台开发，具有极其优良的可移植性，可以快速迁移至其他MCU，本程序依托串口与上位机通信，使用时接串口线和__电池__即可</p>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404301832725.png" alt="image-20240430183243677"></p>
<p>对主菜单的解释</p>
<table>
<thead>
<tr>
<th>功能</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>Plain Servo Test</td>
<td>朴素舵机测试（控制舵机转到特定角度）</td>
</tr>
<tr>
<td>Interval Servo Test</td>
<td>区间舵机测试（控制舵机在特定区间转动）</td>
</tr>
<tr>
<td>Quick Servo Test</td>
<td>快速舵机测试（快速测试舵机好坏）</td>
</tr>
<tr>
<td>Use Multi Channels</td>
<td>使用多个PWM通道，可以一次测试多个舵机</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>STM32</tag>
      </tags>
  </entry>
  <entry>
    <title>开箱Sipeed的SLogic Combo 8，多合一开发调试工具</title>
    <url>/post/e3aef73e.html</url>
    <content><![CDATA[<p><strong>写在前面：今天刚拿到一个好玩的小玩意，SLogic Combo 8，这是一个集逻辑分析仪、四组串口、DAP-Link、CK-Link为一体的开发调试工具，刚拿到就迫不及待地试玩了一下，发现确实好玩ლ(´ڡ&#96;ლ)，进一步丰富和简化了我的工具链，希望可以用的长一些</strong></p>
<h2 id="开箱"><a href="#开箱" class="headerlink" title="开箱"></a>开箱</h2><p>打开包装盒，映入眼帘的就是SLogic的主体了，整体设计的简约大气，通过背面的隐藏式按键和指示灯可以知道当前在哪个模式下，同时通过面板可以知道各个模式下引脚的定义，这点设计的还是很人性化的，并且提供了3.3V和5V两种电平可以选择</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404140028088.jpg" alt="580570c6cf3dfad75f8fe9e0e9619f9"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404140030172.jpg" alt="3ee0e225bdfe8fa4c53dd99e7eabd3f"></p>
<h2 id="试玩"><a href="#试玩" class="headerlink" title="试玩"></a>试玩</h2><p>（未完待续…）</p>
]]></content>
      <categories>
        <category>开箱试玩</category>
      </categories>
      <tags>
        <tag>逻辑分析仪</tag>
      </tags>
  </entry>
  <entry>
    <title>基于ESP-IDF在ESP32S3上移植LVGL和显示触摸驱动</title>
    <url>/post/64bc178b.html</url>
    <content><![CDATA[<p><strong>前言：之前基本一直在搞STM32的开发，想换到别的平台（比如ESP32）试试，也算对自己的一种锻炼和提升，注意到网上关于LVGL移植的教程非常多，但是大部分是基于Arduino平台的，基本没有基于ESP-IDF框架的（即使有也已经过时）。最近入手了几块ESP32的开发板和一块带CTP（电容触摸）的3.5寸IPS屏幕，可视角度和分辨率都不错，作为一个对GUI界面有执着追求的人，我想把当下很火的嵌入式GUI项目<a href="https://lvgl.io/">LVGL - Light and Versatile Embedded Graphics Library</a>移植到我的项目里，并实现一部分优化，让它即使在资源极端有限的情况下也能较为流畅地运行~</strong></p>
<p><strong>进度:</strong></p>
<ul>
<li>（已完成）实现正确显示 - 20240412</li>
<li>（已完成）跑demo、优化帧率 - 20240414</li>
<li>（未完成）基于SquareLine平台设计UI</li>
<li>（未完成）接入各种传感器</li>
</ul>
<h2 id="物料选择"><a href="#物料选择" class="headerlink" title="物料选择"></a>物料选择</h2><ul>
<li><p>ESP32S3开发板一块，比如我使用立创的ESP32-S3开发板（集成串口芯片）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122139635.jpg" alt="087b0e76d0dc9852b9dd31fb43531fa"></p>
</li>
<li><p>3.5寸电容触摸屏（显示驱动为ST7796U，电容触摸驱动为gt911）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122139803.jpg" alt="6dd6fbcc761ede3cc4c3065eba1070c"></p>
</li>
<li><p>杜邦线若干</p>
</li>
<li><p>Type-C数据线</p>
</li>
</ul>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li><p>电脑系统：<code>Windows 11</code></p>
</li>
<li><p>开发环境：<code>Visual Studio Code</code>（至于为什么不用CLion，因为CLion上没配起来IDF框架（抽象））、<code>ESP-IDF_5.1.2</code></p>
</li>
</ul>
<p><em>这里具体配置细节暂时略去，因为最近要重新装系统，到时候刚好重新配置一遍，写个教程补上 - 20240412</em></p>
<h2 id="开工！"><a href="#开工！" class="headerlink" title="开工！"></a>开工！</h2><h3 id="文件准备"><a href="#文件准备" class="headerlink" title="文件准备"></a>文件准备</h3><ul>
<li><p>先找到示例文件夹，在IDF的安装目录下<br><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121501913.png" alt="image-20240412150107877"></p>
</li>
<li><p>打开进入<code>./get-started/</code>，找到<code>hello_world</code>程序并复制出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121502899.png" alt="image-20240412150249861"></p>
</li>
<li><p>再在<code>./peripherals/i2c</code>中找到<code>i2c_tools</code>，也和刚才的<code>hello_world</code>放在一起<br><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121506011.png" alt="image-20240412150606976"></p>
</li>
<li><p>打开<code>Visual Studio Code</code>，选到hello_world目录</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121518948.png" alt="image-20240412151819885"></p>
</li>
<li><p>这里配置一下开发板的信息：<br>1. 插上开发板，点一下左下角的<code>COM1</code>，根据实际选择正确的<code>COM</code><br>1. 点左下角<code>esp32</code>，选择合适的esp芯片型号，比如我就选esp32s3<br>1. 选择<code>OpenOCD</code>的配置文件，一般选择<code>via ESP-PROG</code>就好<br>1. 点左下角的五角星，选择<code>UART</code>（我的开发板上带了TTL芯片）<br>最终配置好应该是这样的：<br><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121527778.png" alt="image-20240412152745759"></p>
</li>
<li><p>在main文件夹里新建一个<code>idf_component.yml</code>文件，并复制以下内容</p>
<p><em><a href="https://docs.espressif.com/projects/idf-component-manager/en/latest/reference/manifest_file.html">这个网站</a>有<code>idf_component.yml</code>的编写规则，这里我就直接用里面的框架了</em></p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">pkg_name:</span> <span class="string">&quot;pkg_version&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>浏览器打开<a href="https://www.espressif.com/">乐鑫官网</a>，在<code>SDKs</code>下找到<code>IDF Component Manager</code>包管理器</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121535817.png" alt="image-20240412153510715"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121546289.png" alt="image-20240412154657218"></p>
</li>
<li><p>在<code>IDF Component Manager</code>中搜索<code>LVGL</code>，这次用的是<code>lvgl</code>和<code>esp_lvgl_port</code>，至于驱动为什么不用<code>lvgl_esp32_drivers</code>，是因为这玩意的代码已经很久没有维护了，不支持<code>IDF5.x</code>版本和较新的<code>LVGL</code></p>
<p>这次用的是<code>1.4.0</code>版本的<code>esp_lvgl_port</code>，在<code>idf_component.yml</code>中把<code>pkg_name</code>换成<code>esp_lvgl_port</code>，因为我们这次移植的是<code>8.4.0</code>的<code>LVGL</code>，所以<code>pkg_version</code>改成<code>1.4.0</code>，把<code>LVGL</code>和<code>gt911触摸芯片</code>和<code>ST7796显示芯片</code>的驱动也加上，像下面这样</p>
</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">esp_lvgl_port:</span> <span class="string">&quot;1.4.0&quot;</span></span><br><span class="line">  <span class="attr">esp_lcd_touch_gt911:</span> <span class="string">&quot;1.1.0&quot;</span></span><br><span class="line">  <span class="attr">esp_lcd_st7796:</span> <span class="string">&quot;1.2.1&quot;</span></span><br><span class="line">  <span class="attr">lvgl/lvgl:</span> <span class="string">&quot;8.4.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>  然后编译一次就会自动下载相关依赖（这里即使最后编译报错了也没关系，因为依赖已经下好了，报错稍后再去解决）</p>
<p>  待依赖下载完成之后，工作空间的根目录会出现<code>managed_components</code>文件夹，把这个文件夹改为<code>components</code>（这步是因为可能要修改某些依赖的源码，如果不这样的话修改后会报<code>哈希不匹配</code>的错），把里面的依赖整理一下，像这样<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121647535.png" alt="image-20240412164748491"></p>
<p>  检查每个依赖中的其他关联依赖（<code>idf_component.yml</code>），把所有除了IDF以外的其他依赖全部删掉</p>
<ul>
<li><p>把<code>./esp_lvgl_port/examples/touchscreen/main/</code>下的<code>main.c</code>文件的全部内容复制到hello_world_main.c里<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121657456.png"></p>
</li>
<li><p>顺便说一下，如果VScode没法代码补全和代码跳转的话，按下<code>Ctrl+Shift+P</code>，搜索<code>IntelliSense</code>，选择第一个不带bootloader的，选好之后Full Clean，再点一下编译，就可以正常使用了</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121808911.png" alt="image-20240412180848835"></p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121809959.png" alt="image-20240412180922880"></p>
</li>
<li><p>编译一下，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121659815.png" alt="image-20240412165942792"></p>
<p>可以看到找不到对应的头文件，这里示例文件默认用的触摸驱动是tt21100，与我用的gt911不一样，所以我们要包含gt911的驱动进去，故要做的就是修改头文件，把tt21100的驱动换成gt911的，并且把程序里调用的函数进行对应的更改</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_lcd_touch_tt21100.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>更改为</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_lcd_touch_gt911.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>对应的函数改为gt911</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121815198.png" alt="image-20240412181507168"></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121816895.png" alt="image-20240412181658868"></p>
<p>再次编译，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121820971.png" alt="image-20240412182013943"></p>
<p>注意到这里找不到<code>lvgl.h</code>的错误是<code>esp_lvgl_port</code>这个依赖发出的，所以进入该依赖的<code>CmakeLists.txt</code>，在<code>PRIV_REQUIRES</code>里加入<code>lvgl</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121821249.png" alt="image-20240412182143182"></p>
<p>再次编译，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121822908.png" alt="image-20240412182235878"></p>
<p>这里gt911的驱动报错找不到<code>driver/gpio.h</code>，与上面类似地，修改gt911的驱动里的<code>CmakeLists.txt</code>，在<code>PRIV_REQUIRES</code>里加入<code>driver</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121824523.png" alt="image-20240412182412458"></p>
<p>再编译，看看报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121825244.png" alt="image-20240412182513212"></p>
<p>这里gt911的驱动报错找不到<code>esp_lcd_touch.h</code>，与上面类似地，修改gt911的驱动里的<code>CmakeLists.txt</code>，在<code>PRIV_REQUIRES</code>里加入<code>esp_lcd_touch</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121826592.png"></p>
<p>再次编译，发现可以编译通过了！（好吧，其实离能用还有很远）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121827054.png" alt="image-20240412182738026"></p>
<h3 id="硬件连线"><a href="#硬件连线" class="headerlink" title="硬件连线"></a>硬件连线</h3><p>查看开发板的原理图和乐鑫ESP32S3技术文档，应该按照下表接线</p>
<table>
<thead>
<tr>
<th align="center">屏幕+触摸</th>
<th align="center">ESP32S3开发板</th>
</tr>
</thead>
<tbody><tr>
<td align="center">VDD</td>
<td align="center">3V3</td>
</tr>
<tr>
<td align="center">GND</td>
<td align="center">GND</td>
</tr>
<tr>
<td align="center">SCLK</td>
<td align="center">GPIO_NUM_12</td>
</tr>
<tr>
<td align="center">MOSI</td>
<td align="center">GPIO_NUM_11</td>
</tr>
<tr>
<td align="center">RST</td>
<td align="center">GPIO_NUM_3</td>
</tr>
<tr>
<td align="center">DC</td>
<td align="center">GPIO_NUM_9</td>
</tr>
<tr>
<td align="center">CS</td>
<td align="center">GPIO_NUM_10</td>
</tr>
<tr>
<td align="center">BL</td>
<td align="center">GPIO_NUM_46</td>
</tr>
<tr>
<td align="center">I2C_SCL</td>
<td align="center">GPIO_NUM_2</td>
</tr>
<tr>
<td align="center">I2C_SDA</td>
<td align="center">GPIO_NUM_1</td>
</tr>
<tr>
<td align="center">CTP_INT</td>
<td align="center">GPIO_NUM_45</td>
</tr>
</tbody></table>
</li>
</ul>
<p><strong>注意：VDD和GND千万不能接错，否则烧毁！</strong></p>
<p>接好线后烧录刚才的程序试一下，然后…咦？屏幕怎么没反应呢？？？</p>
<p>原来是接线没有在程序里映射出来，这里修改<code>hello_world_main.c</code>的第24-50行为，在不同硬件上需要做相应调整</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* LCD settings */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_SPI_NUM         (SPI3_HOST)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_PIXEL_CLK_HZ    (40 * 1000 * 1000)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_CMD_BITS        (8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_PARAM_BITS      (8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_COLOR_SPACE     (ESP_LCD_COLOR_SPACE_BGR)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_BITS_PER_PIXEL  (16)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_DRAW_BUFF_DOUBLE (1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_DRAW_BUFF_HEIGHT (50)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_BL_ON_LEVEL     (1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD pins */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_SCLK       (GPIO_NUM_12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_MOSI       (GPIO_NUM_11)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_RST        (GPIO_NUM_3)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_DC         (GPIO_NUM_9)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_CS         (GPIO_NUM_10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_LCD_GPIO_BL         (GPIO_NUM_46)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Touch settings */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_NUM       (0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_CLK_HZ    (400000)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* LCD touch pins */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_SCL       (GPIO_NUM_2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_I2C_SDA       (GPIO_NUM_1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXAMPLE_TOUCH_GPIO_INT      (GPIO_NUM_45)</span></span><br></pre></td></tr></table></figure>

<p>改完之后再次烧录，发现屏幕不断滚动报错</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121851092.png" alt="image-20240412185134048"></p>
<p>看红字知道报错是因为I2C总线上没有找到gt911，这就比较奇怪了，难道是因为I2C地址错了吗？幸好乐鑫提供了一个专门的I2C检测工具，可以遍历所有I2C地址，还记得和hello_world工程一起复制过来的i2c_tools工程吗，现在需要用到它了</p>
<p>在VScode中打开<code>i2c_tools</code>工程，编译烧录，在终端中可以看到进入了<code>i2c_tools</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121938181.png" alt="image-20240412193813115"></p>
<p>输入<code>i2cdetect</code>即可遍历总线上的地址</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121938576.png" alt="image-20240412193850546"></p>
<p>这里出现了<code>0x14</code>，当前挂载在I2C总线上的只有一个设备，所以gt911的地址是<code>0x14</code>，然后我们回到hello_world程序，打开<code>/components/esp_lcd_touch_gt911/include/esp_lcd_touch_gt911.h</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121942008.png" alt="image-20240412194202971"></p>
<p>可以看到定义了两个I2C地址，在结构体中调用了一个，这里看到调用的是<code>ESP_LCD_TOUCH_IO_I2C_gt911_ADDRESS</code>，值为<code>0x5D</code>，与实际地址<code>0x14</code>不符合，而<code>ESP_LCD_TOUCH_IO_I2C_gt911_ADDRESS_BACKUP</code>的值为<code>0x14</code>，所以结构体里改为<code>ESP_LCD_TOUCH_IO_I2C_gt911_ADDRESS_BACKUP</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121944838.png" alt="image-20240412194432812"></p>
<h3 id="改代码"><a href="#改代码" class="headerlink" title="改代码"></a>改代码</h3><p>再次烧录，看看效果__结果还是不行，还是报I2C的错误，这里我们查看原理图，发现屏幕的I2C没有上拉__，所以我们需要打开芯片的内部上拉</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404121954480.png" alt="image-20240412195427450"></p>
<p>然后再次烧录，屏幕成功点亮，但是显示有点奇怪</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122139981.jpg" alt="0f0e9dbd753c2ea81331be530d4058f"></p>
<p>现在发现：</p>
<ol>
<li>长宽不对</li>
<li>字显示不清晰</li>
<li>屏幕镜像颠倒 </li>
<li>触摸X、Y轴反向</li>
</ol>
<p>现在开始逐一解决：</p>
<ol>
<li>设置长宽，更改宏定义里的<code>EXAMPLE_LCD_H_RES</code>为320，<code>EXAMPLE_LCD_V_RES</code>为480</li>
<li>点左下角小齿轮，进入<code>SDK Configuration editor</code>，搜索<code>Swap</code>，找到这个选项，打上勾（改完记得保存）<br> <img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122005348.png" alt="image-20240412200541312"></li>
<li>这两个<code>true</code>随便改一个为<code>false</code><br> <img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122021990.png" alt="image-20240412202126956"></li>
<li>把结构体里的<code>mirror_x</code>的1改为0，<code>mirror_y</code>的0改为1<br> <img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122047197.png" alt="image-20240412204715167"></li>
</ol>
<p>然后再次烧录测试，发现颜色还是不对，背景是黑色的，但是理论上应该是白色<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122138345.jpg" alt="c4ae5d37df49d5748cd673873cdaece"></p>
<p>考虑到屏幕的面板是IPS的，而默认显示驱动可能支持的是TN屏，我这里选择魔改另外一款默认为IPS的显示驱动芯片（ili9341）的驱动程序，具体操作如下：</p>
<ol>
<li><p>通过<code>idf-component</code>下载<code>esp_lcd_ili9341</code>并移动到<code>components</code>目录下，并修改<code>esp_lcd_ili9341</code>的<code>idf-component.yml</code></p>
</li>
<li><p>修改<code>/esp_lcd_ili9341/esp_lcd_ili9341.c</code>的<code>vendor_specific_init_default</code>数组为（这里是参照屏幕厂商的驱动改的）</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"> <span class="type">const</span> <span class="type">ili9341_lcd_init_cmd_t</span> vendor_specific_init_default[] = &#123;</span><br><span class="line"><span class="comment">//  &#123;cmd, &#123; data &#125;, data_size, delay_ms&#125;</span></span><br><span class="line">    <span class="comment">/* Power contorl B, power control = 0, DC_ENA = 1 */</span></span><br><span class="line">    <span class="comment">// &#123;0x11, (uint8_t [])&#123;0x00&#125;, 0, 120&#125;,</span></span><br><span class="line">    &#123;<span class="number">0xB2</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x0C</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x33</span>, <span class="number">0x33</span>&#125;, <span class="number">5</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xB0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>, <span class="number">0xE0</span>&#125;, <span class="number">2</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    <span class="comment">// &#123;0x36, (uint8_t [])&#123;0x00&#125;, 1, 0&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;0x3A, (uint8_t [])&#123;0x05&#125;, 1, 0&#125;,</span></span><br><span class="line">    &#123;<span class="number">0xB7</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x56</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xBB</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x14</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x2C</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC2</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x01</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC3</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x0B</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC4</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x10</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xC6</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x0F</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xD0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xA4</span>, <span class="number">0xA1</span>&#125;, <span class="number">2</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xD6</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xA1</span>&#125;, <span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xE0</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xD0</span>, <span class="number">0x08</span>, <span class="number">0x0A</span>, <span class="number">0x0D</span>, <span class="number">0x0B</span>, <span class="number">0x07</span>, <span class="number">0x21</span>, <span class="number">0x33</span>, <span class="number">0x39</span>, <span class="number">0x39</span>, <span class="number">0x16</span>, <span class="number">0x16</span>, <span class="number">0x1F</span>, <span class="number">0x3C</span>&#125;, <span class="number">14</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0xE1</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0xD0</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x21</span>, <span class="number">0x32</span>, <span class="number">0x38</span>, <span class="number">0x16</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x20</span>, <span class="number">0x3D</span>&#125;, <span class="number">14</span>, <span class="number">0</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x21</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">0</span>, <span class="number">120</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x29</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="number">0x2C</span>, (<span class="type">uint8_t</span> [])&#123;<span class="number">0x00</span>&#125;, <span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>至此驱动修改完毕，在<code>hello_world_main.c</code>中include一下<code>esp_lcd_ili9341.h</code>，把<code>esp_lcd_new_panel_st7796</code>函数改为<code>esp_lcd_new_panel_ili9341</code>，烧录看看效果</p>
</li>
</ol>
<h3 id="正常显示-20240412"><a href="#正常显示-20240412" class="headerlink" title="正常显示 - 20240412"></a>正常显示 - 20240412</h3><p>可以看到，已经正确显示了（但其实旋转方向之后显示还是不太对，屏幕会镜像，不知道为什么，应该还是驱动的问题）<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404122138205.jpg" alt="61e5f02c1fdb5e1fd49e2a5a34a134b"></p>
<h3 id="跑demo-20240414"><a href="#跑demo-20240414" class="headerlink" title="跑demo - 20240414"></a>跑demo - 20240414</h3><h4 id="Music音乐播放器demo"><a href="#Music音乐播放器demo" class="headerlink" title="Music音乐播放器demo"></a>Music音乐播放器demo</h4><p>点左下角小齿轮，进入<code>SDK Configuration editor</code>，找到LVGL相关的设置</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141416848.png" alt="image-20240414141602770"></p>
<p>在<code>Demos</code>里面勾选<code>Music player demo</code>，别忘了保存</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141417085.png" alt="image-20240414141718058"></p>
<p>然后回到hello_world_main.c里，找到函数<code>app_main_display()</code>，将里面的<code>Label</code>和<code>Button</code>注释掉，并在后面加上lv_demo_music函数的声明和调用</p>
<p><em>这里补充一点，C语言可以在函数里面声明函数，格式与在函数之外相同。 声明后的函数只在本函数内调用有效。其他函数需要重新声明</em></p>
<p>修改好后的app_main_display()函数如下</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">app_main_display</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">lv_obj_t</span> *scr = lv_scr_act();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Task lock */</span></span><br><span class="line">    lvgl_port_lock(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Your LVGL objects code here .... */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// /* Label */</span></span><br><span class="line">    <span class="comment">// lv_obj_t *label = lv_label_create(scr);</span></span><br><span class="line">    <span class="comment">// lv_label_set_recolor(label, true);</span></span><br><span class="line">    <span class="comment">// lv_obj_set_width(label, EXAMPLE_LCD_H_RES);</span></span><br><span class="line">    <span class="comment">// lv_obj_set_style_text_align(label, LV_TEXT_ALIGN_CENTER, 0);</span></span><br><span class="line">    <span class="comment">// lv_label_set_text(label, &quot;#FF0000 &quot;LV_SYMBOL_BELL&quot; Hello world Espressif and LVGL &quot;LV_SYMBOL_BELL&quot;#\n#FF9400 &quot;LV_SYMBOL_WARNING&quot; For simplier initialization, use BSP &quot;LV_SYMBOL_WARNING&quot; #&quot;);</span></span><br><span class="line">    <span class="comment">// lv_obj_align(label, LV_ALIGN_CENTER, 0, -30);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// /* Button */</span></span><br><span class="line">    <span class="comment">// lv_obj_t *btn = lv_btn_create(scr);</span></span><br><span class="line">    <span class="comment">// label = lv_label_create(btn);</span></span><br><span class="line">    <span class="comment">// lv_label_set_text_static(label, &quot;Rotate screen&quot;);</span></span><br><span class="line">    <span class="comment">// lv_obj_align(btn, LV_ALIGN_BOTTOM_MID, 0, -30);</span></span><br><span class="line">    <span class="comment">// lv_obj_add_event_cb(btn, _app_button_cb, LV_EVENT_CLICKED, NULL);</span></span><br><span class="line">    <span class="type">void</span> <span class="title function_">lv_demo_music</span><span class="params">(<span class="type">void</span>)</span>; </span><br><span class="line">    lv_demo_music();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Task unlock */</span></span><br><span class="line">    lvgl_port_unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们编译试试，看会不会报错<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141423001.png" alt="image-20240414142329954"></p>
<p>还真报错了，这里说的是找不到需要的字体，点左下角小齿轮进入LVGL的配置界面，在Font usage里勾选上12和16号字体，记得保存</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141424111.png" alt="image-20240414142453070"></p>
<p>再编译试试，可以看到已经编译过了<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141429970.png" alt="image-20240414142923937"></p>
<p>那就烧录看看效果吧（这里有可能触摸的X或者Y还会反，再去改tp_cfg结构体里的mirror_x或者mirror_y就行）<img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141435341.jpg" alt="0396dc12365b70b64f1728d4a349420"></p>
<p>可以看到显示和触摸都正常了</p>
<h3 id="跑组件（Widget）demo"><a href="#跑组件（Widget）demo" class="headerlink" title="跑组件（Widget）demo"></a>跑组件（Widget）demo</h3><h3 id="优化帧率-20240414"><a href="#优化帧率-20240414" class="headerlink" title="优化帧率 - 20240414"></a>优化帧率 - 20240414</h3><p>打开<a href="https://www.espressif.com/">乐鑫官网</a>，点顶部的Support，在找到ESP-FAQ，搜索LVGL，即可找到如下内容</p>
<ul>
<li><p>Taking ESP32-S3R8 as an example, the following ESP configuration items can improve the frame rate (ESP-IDF release&#x2F;v5.1):</p>
<ul>
<li><code>CONFIG_FREERTOS_HZ=1000</code></li>
<li><code>CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240=y</code></li>
<li><code>CONFIG_ESPTOOLPY_FLASHMODE_QIO=y</code></li>
<li><code>CONFIG_ESPTOOLPY_FLASHFREQ_120M=y</code> [should be consistent with PSRAM]</li>
<li><code>CONFIG_SPIRAM_MODE_OCT=y</code></li>
<li><code>CONFIG_IDF_EXPERIMENTAL_FEATURES=y</code> and <code>CONFIG_SPIRAM_SPEED_120M=y</code> [should be consistent with FLASH]</li>
<li><code>CONFIG_SPIRAM_FETCH_INSTRUCTIONS=y</code></li>
<li><code>CONFIG_SPIRAM_RODATA=y</code></li>
<li><code>CONFIG_ESP32S3_DATA_CACHE_LINE_64B=y</code></li>
<li><code>CONFIG_COMPILER_OPTIMIZATION_PERF=y</code></li>
</ul>
</li>
<li><p>The following LVGL configuration items can improve the frame rate (LVGL v8.3):</p>
<ul>
<li><p><code>#define LV_MEM_CUSTOM 1</code> or <code>CONFIG_LV_MEM_CUSTOM=y</code></p>
</li>
<li><p><code>#define LV_MEMCPY_MEMSET_STD 1</code> or <code>CONFIG_LV_MEMCPY_MEMSET_STD=y</code></p>
</li>
<li><p><code>#define LV_ATTRIBUTE_FAST_MEM IRAM_ATTR</code> or <code>CONFIG_LV_ATTRIBUTE_FAST_MEM=y</code></p>
</li>
</ul>
</li>
</ul>
<p>再加一个<code>LV_DISP_DEF_REFR_PERIOD</code>由30改为10</p>
<p>注：如果要显示帧率和CPU占用，可以吧<code>Show CPU usage and FPS count</code>勾上</p>
<p>这里就按照官网的推荐来进行修改，点左下角小齿轮，分别修改上面的这些参数（修改完记得保存），其中某些参数可能找不到，这是由于CSDK的版本和使用的MCU型号不同导致的，不用深究</p>
<p>修改hello_world_main.c里的SPI频率到80M（实测这个影响帧率最为明显）</p>
<p><img src="https://cdn.jsdelivr.net/gh/MDLZCOOL/blog-img/img/202404141458859.png" alt="image-20240414145809827"></p>
<p>改完以后再来编译烧录，发现帧率提升了很多，滑动较为丝滑了</p>
]]></content>
      <categories>
        <category>Dev</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
        <tag>LVGL</tag>
        <tag>ESP-IDF</tag>
      </tags>
  </entry>
</search>
